<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <div class="car-booking-container">
    <div class="breadcrumb">
      <a href="/cars">Cars</a> &gt; Car booking
    </div>
  
    <h1>Car booking</h1>
  
    <section class="booking-section">
      <form [formGroup]="bookingForm">
        <!-- Personal Info Section -->
        <div class="section">
          <h2>Personal info</h2>
          <div class="personal-info-card" formGroupName="personalInfo">
            <div class="form-field">
              <div class="full-name">{{ bookingForm.get('personalInfo.fullName')?.value }}</div>
              <div class="email">{{ bookingForm.get('personalInfo.email')?.value }}</div>
              <div class="phone">{{ bookingForm.get('personalInfo.phone')?.value }}</div>
            </div>
          </div>
        </div>
  
        <!-- Location Section -->
        <div class="section">
          <h2>Location</h2>
          <div class="location-card" formGroupName="location">
            <div class="form-field">
              <label>Pick-up location<span class="required">*</span></label>
              <div class="select-wrapper" (click)="openLocationModal(true)" 
                  [ngClass]="{'invalid-location': isLocationInvalid('pickupLocation')}">
                <div class="location-display">
                  {{ selectedPickupLocation || 'Choose location' }}
                </div>
              </div>
              <div class="error-message" *ngIf="isLocationInvalid('pickupLocation')">
                Pick-up location is required
              </div>
            </div>
            <div class="form-field">
              <label>Drop-off location<span class="required">*</span></label>
              <div class="select-wrapper" (click)="openLocationModal(false)"
                  [ngClass]="{'invalid-location': isLocationInvalid('dropoffLocation')}">
                <div class="location-display">
                  {{ selectedDropoffLocation || 'Choose location' }}
                </div>
              </div>
              <div class="error-message" *ngIf="isLocationInvalid('dropoffLocation')">
                Drop-off location is required
              </div>
            </div>
            <div class="w-full pb-4">
              <button type="button" class="change-btn" (click)="openLocationModal(true)">Change</button>
            </div>
          </div>
        </div>
  
        <!-- Dates & Time Section -->
        <div class="section">
          <h2>Dates & Time</h2>
          <div class="dates-card" formGroupName="dates">
            <div class="w-full pb-8">
              <button type="button" class="change-btn" (click)="toggleCalendar()">Change</button>
            </div>
            <!-- In car-booking.component.html -->
            <calendar class="booking-calendar" [externalToggle]="isCalendarOpen" [initialStartDate]="dateFrom"
              [initialEndDate]="dateTo" [bookedDates]="bookedDatesFormatted"
              (dateRangeSelected)="onDateRangeSelected($event)">
            </calendar>
          </div>
        </div>
      </form>
  
      <!-- Car Details and Confirmation Section -->
      <div class="section-car-details-section">
        <div class="car-details-container" *ngIf="selectedCar">
          <div class="car-image">
            <!-- Use the primary image from the car details -->
            <img [src]="selectedCar.images[0].url || selectedCar.images[0]" class="image-car"
                 [alt]="selectedCar.brand + ' ' + selectedCar.model">
          </div>
          <div class="car-info">
            <h3>{{ selectedCar.brand }} {{ selectedCar.model }} {{ selectedCar.year }}</h3>
            <p class="location">{{ selectedCar.location }}</p>
        
            <div class="pricing-info">
              <div class="total-section">
                <div class="total-label">Total</div>
                <div class="total-price">${{ totalPrice }}</div>
              </div>
              <div class="deposit-info">Deposit: ${{ depositAmount }}</div>
              <button type="button" class="confirm-btn" (click)="confirmReservation()" [disabled]="!isFormValid()">
                Confirm reservation
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  
    <div class="location-modal" *ngIf="showPickupModal">
      <div class="location-modal-content">
        <div class="location-modal-header">
          <h3>Choose pick-up location</h3>
          <button class="close-modal" (click)="closeLocationModal()">&times;</button>
        </div>
        
        <div class="location-modal-body">
          <button class="use-current-location" (click)="useCurrentLocation(true)">
            <span class="location-icon">üìç</span>
            Use current location
          </button>
          
          <div class="location-search-container">
            <input 
              type="text" 
              placeholder="Search for a city or address" 
              [(ngModel)]="pickupSearchQuery"
              (input)="onPickupSearchInput()"
              class="location-search-input"
            >
            
            <div class="location-suggestions" *ngIf="showPickupSuggestions">
              <div class="loading-suggestions" *ngIf="isLoadingPickupSuggestions">
                Searching...
              </div>
              <div class="no-suggestions" *ngIf="!isLoadingPickupSuggestions && pickupSuggestions.length === 0 && pickupSearchQuery.length > 1">
                No locations found
              </div>
              <div 
                class="suggestion-item" 
                *ngFor="let suggestion of pickupSuggestions"
                (click)="selectPickupLocation(suggestion)"
              >
                <span class="suggestion-icon">üìç</span>
                <span class="suggestion-text">{{ suggestion.displayName }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Dropoff Location Modal -->
    <div class="location-modal" *ngIf="showDropoffModal">
      <div class="location-modal-content">
        <div class="location-modal-header">
          <h3>Choose drop-off location</h3>
          <button class="close-modal" (click)="closeLocationModal()">&times;</button>
        </div>
        
        <div class="location-modal-body">
          <button class="use-current-location" (click)="useCurrentLocation(false)">
            <span class="location-icon">üìç</span>
            Use current location
          </button>
          
          <div class="location-search-container">
            <input 
              type="text" 
              placeholder="Search for a city or address" 
              [(ngModel)]="dropoffSearchQuery"
              (input)="onDropoffSearchInput()"
              class="location-search-input"
            >
            
            <div class="location-suggestions" *ngIf="showDropoffSuggestions">
              <div class="loading-suggestions" *ngIf="isLoadingDropoffSuggestions">
                Searching...
              </div>
              <div class="no-suggestions" *ngIf="!isLoadingDropoffSuggestions && dropoffSuggestions.length === 0 && dropoffSearchQuery.length > 1">
                No locations found
              </div>
              <div 
                class="suggestion-item" 
                *ngFor="let suggestion of dropoffSuggestions"
                (click)="selectDropoffLocation(suggestion)"
              >
                <span class="suggestion-icon">üìç</span>
                <span class="suggestion-text">{{ suggestion.displayName }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>

