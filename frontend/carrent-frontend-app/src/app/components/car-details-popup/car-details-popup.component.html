<div
  class="relative bg-[#FFFBF3] p-4 w-full h-full max-w-6xl mx-auto shadow-md flex flex-col lg:flex-row overflow-y-auto max-h-screen sm:rounded-lg car-details"
  role="dialog" aria-labelledby="car-details-title" *ngIf="carDetails">
  <!-- Login Notification -->
  <app-notification [show]="showLoginNotification" (cancel)="hideLoginNotification()" (login)="handleLogin()">
  </app-notification>
  <!-- Close Button -->
  <button (click)="close()" aria-label="Close dialog"
    class="absolute top-4 right-4 text-gray-600 hover:text-red-500 text-xl pb-2">
    <mat-icon>close</mat-icon>
  </button>

  <div class="flex-none p-2 pt-2 mt-6 w-full">
    <!-- Image Gallery -->
    <div class="w-full flex flex-col lg:flex-row gap-4 mb-6 lg:mb-0">
      <!-- Thumbnail List -->
      <div
        class="thumbnail-list flex flex-row lg:flex-col gap-3 overflow-x-auto lg:overflow-y-auto lg:h-[350px] h-[100px] w-full lg:w-[10%]">
        <div *ngFor="let image of carDetails.images"
          class="min-w-[100px] lg:min-w-full lg:h-[200px] h-full rounded-md cursor-pointer border-2 transition flex-shrink-0 lg:flex-shrink"
          [ngClass]="{'border-red-500': image.isPrimary,'border-gray-200': !image.isPrimary}"
          (click)="selectImage(image)">
          <img [src]="image.url" [alt]="carDetails.model" class="w-full h-full object-cover rounded" />
        </div>
      </div>


      <!-- Main Image Display -->
      <div class="relative w-full lg:w-[60%] h-[200px] md:h-[300px] lg:h-[350px]">
        <img [src]="getPrimaryImageUrl()" [alt]="carDetails.model"
          class="w-full h-full object-cover rounded-xl shadow-md" />
        <!-- Car Status Badge -->
        <div class="absolute top-2 left-2 border border-gray-100 rounded-md w-[100px] bg-white text-sm text-center"
          [ngClass]="{
  'text-green-600': carDetails.status === 'Available',
  'text-red-600': carDetails.status === 'Not Available'
}">
          {{ carDetails.status }}
        </div>
      </div>

      <!-- Car Details Section -->
      <div
        class="bg-[#F0F0F0] rounded-xl p-4 shadow-md w-full lg:w-[40%] flex flex-col justify-between max-h-[350px] mt-4 lg:mt-0">
        <!-- Header -->
        <div class="flex items-start justify-between mb-2">
          <div class="mb-2">
            <h2 class="text-base font-semibold">
              {{ carDetails.brand }} {{ carDetails.model }}
              {{ carDetails.year }}
            </h2>
            <p class="text-gray-500 text-sm">{{ carDetails.location }}</p>
          </div>
          <div class="flex items-center mt-1">
            <span class="text-base font-medium">{{ carDetails.rating }}</span>
            <mat-icon style="color: #facc15; font-size: 20px">star</mat-icon>
          </div>
        </div>
        <!-- Specs Grid -->
        <div class="grid grid-cols-2 gap-2 mb-2 text-xs">
          <!-- Example Spec Row -->
          <div class="flex items-center gap-2">
            <mat-icon class="text-gray-500">sync_alt</mat-icon>
            {{ carDetails.specifications.transmission }}
          </div>

          <div class="flex items-center gap-2">
            <mat-icon class="text-gray-500">engineering</mat-icon>
            {{ carDetails.specifications.engine }}
          </div>

          <div class="flex items-center gap-2">
            <mat-icon class="text-gray-500">local_gas_station</mat-icon>
            {{ carDetails.specifications.fuelType }}
          </div>

          <div class="flex items-center gap-2">
            <mat-icon class="text-gray-500">event_seat</mat-icon>
            {{ carDetails.specifications.seats }} seats
          </div>

          <div class="flex items-center gap-2">
            <mat-icon class="text-gray-500">speed</mat-icon>
            {{ carDetails.specifications.fuelConsumption }}
          </div>

          <!-- Features (like GPS, Bluetooth, etc.) -->
          <div *ngFor="let feature of carDetails.specifications.features" class="flex items-center gap-2">
            <mat-icon class="text-gray-500">check_circle</mat-icon>
            {{ feature }}
          </div>
        </div>

        <!-- Need to Add dateRange picker -->
        

        <!-- car-details-popup.component.html -->
        <button
          class="w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed"
          (click)="bookCar()" [disabled]="!dateRange">
          Book the car - ${{ carDetails.price }}/day
        </button>

      </div>
    </div>

    <!-- Reviews Section -->
    <div class="mt-6 pb-6">
      <div
        class="review-section bg-[#F0F0F0] p-4 md:p-6 rounded-lg shadow-md flex flex-col gap-4 max-h-[350px] overflow-y-auto">
        <!-- Header -->
        <div class="flex-none flex items-center justify-between mb-2 border-b border-gray-300 pb-2">
          <h3 class="text-lg font-normal">Feedback</h3>
          <!-- Dropdown Container -->
          <div class="relative">
            <button (click)="toggleDropdown()"
              class="flex items-center gap-2 text-sm text-gray-500 hover:text-gray-700 focus:outline-none">
              <span>Sort by: {{ selectedSort }}</span>
              <mat-icon class="text-base transition-transform duration-200" [class.rotate-180]="isDropdownOpen">
                {{ isDropdownOpen ? 'keyboard_arrow_up' : 'keyboard_arrow_down' }}
              </mat-icon>
            </button>

            <!-- Dropdown Menu -->
            <div *ngIf="isDropdownOpen" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 z-10">
              <button *ngFor="let option of sortOptions" (click)="selectSort(option.value)"
                class="w-full px-4 py-2 text-sm text-left hover:bg-gray-100 focus:outline-none"
                [class.font-medium]="selectedSort === option.value">
                {{ option.label }}
              </button>
            </div>
          </div>
        </div>

        <!-- Reviews List - Scrollable -->
        <div class="flex-1 overflow-y-auto pr-2">
          <div class="space-y-6">
            <div class="border-b border-gray-300 pb-2" *ngFor="let review of reviews">
              <div class="flex gap-4">
                <!-- Left: Avatar and Name - Fixed width -->
                <div class="w-[150px] shrink-0">
                  <div class="flex items-center gap-2">
                    <img [src]="review.userAvatar" class="w-10 h-10 rounded-full" alt="avatar" />
                    <span class="font-medium text-sm truncate">{{ review.userName }}</span>
                  </div>
                </div>

                <!-- Middle: Rating and Comment -->
                <div class="flex-1">
                  <div class="flex flex-col">
                    <!-- Star Rating -->
                    <div class="flex items-center mb-1">
                      <mat-icon *ngFor="let _ of getFilledStars(review.rating)"
                        style="color: #facc15; font-size: 16px;">star</mat-icon>
                      <mat-icon *ngFor="let _ of getEmptyStars(review.rating)"
                        style="color: #d1d5dc; font-size: 16px;">star</mat-icon>
                    </div>
                    <!-- Comment -->
                    <p class="text-gray-700 text-sm">{{ review.comment }}</p>
                  </div>
                </div>

                <!-- Right: Date -->
                <div class="w-[100px] shrink-0 text-right">
                  <span class="text-sm text-gray-500">{{ review.date | date }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Add this above the reviews section -->
        <div class="flex justify-center items-center gap-2 mt-2 mb-2">
          <!-- Previous Page Button -->
          <button (click)="onCarPageChange(currentCarIndex - 1)" [disabled]="currentCarIndex === 0"
            class="p-1 hover:cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed">
            <mat-icon>chevron_left</mat-icon>
          </button>

          <!-- Page Numbers in Circles -->
          <div class="flex items-center gap-1">
            <ng-container *ngFor="let i of [-1, 0, 1]">
              <!-- Calculate the page number to show -->
              <button *ngIf="(currentCarIndex + i) >= 0 && (currentCarIndex + i) < totalCars"
                (click)="onCarPageChange(currentCarIndex + i)"
                class="w-8 h-8 rounded-full border flex items-center justify-center text-sm hover:cursor-pointer hover:bg-gray-100"
                [ngClass]="{
                  'bg-black text-white': (currentCarIndex + i) === currentCarIndex,
                  'bg-white text-black': (currentCarIndex + i) !== currentCarIndex
                }">
                {{ currentCarIndex + i + 1 }}
              </button>
            </ng-container>
          </div>


          <!-- Next Page Button -->
          <button (click)="onCarPageChange(currentCarIndex + 1)" [disabled]="currentCarIndex >= totalCars - 1"
            class="p-2 hover:cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed">
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>

      </div>
    </div>
  </div>
</div>